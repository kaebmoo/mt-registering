<!-- templates/index_multi_with_qr.html -->
{% extends "base.html" %}

{% block title %}ลงทะเบียนการประชุม{% endblock %}

{% block content %}
<div class="ui container">
    <h1 class="ui header">
        <i class="calendar check icon"></i>
        <div class="content">
            ระบบลงทะเบียนการประชุม
            <div class="sub header">เลือกการประชุมที่ต้องการลงทะเบียน หรือสแกน QR Code</div>
        </div>
    </h1>

    {% if meetings %}
    <div class="ui cards">
        {% for meeting in meetings %}
        <div class="card">
            <div class="content">
                <div class="header">{{ meeting.topic }}</div>
                <div class="meta">
                    <span class="date">{{ meeting.meeting_date.strftime('%d/%m/%Y') }}</span>
                </div>
                <div class="description">
                    <p><i class="clock icon"></i> {{ meeting.start_time.strftime('%H:%M') }} - {{ meeting.end_time.strftime('%H:%M') }}</p>
                    <p><i class="map marker icon"></i> ห้อง {{ meeting.room }} ชั้น {{ meeting.floor }} อาคาร {{ meeting.building }}</p>
                    {% if meeting.organizer %}
                    <p><i class="user icon"></i> ผู้จัด: {{ meeting.organizer.name }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- QR Code Section -->
            <div class="image">
                <div style="padding: 20px; background: #f8f9fa; text-align: center;">
                    <img src="data:image/png;base64,{{ get_meeting_qr(meeting.id) }}" 
                         alt="QR Code for {{ meeting.topic }}"
                         style="max-width: 200px; width: 100%; height: auto;">
                    <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                        <i class="qrcode icon"></i> สแกน QR Code เพื่อลงทะเบียน
                    </p>
                </div>
            </div>
            
            <div class="extra content">
                <div class="ui two buttons">
                    <a href="{{ url_for('register', meeting_id=meeting.id) }}" 
                       class="ui primary button">
                        <i class="sign in icon"></i> ลงทะเบียน
                    </a>
                    <a href="{{ url_for('meeting_qrcode', meeting_id=meeting.id) }}" 
                       class="ui basic button">
                        <i class="qrcode icon"></i> QR Code
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="ui warning message">
        <div class="header">ไม่มีการประชุมที่เปิดให้ลงทะเบียน</div>
        <p>ขณะนี้ไม่มีการประชุมที่เปิดรับลงทะเบียน กรุณาตรวจสอบใหม่ภายหลัง</p>
    </div>
    {% endif %}
    
    <div class="ui divider"></div>
    
    <div class="ui secondary menu">
        <a class="item" href="{{ url_for('auth.login') }}">
            <i class="user icon"></i> เข้าสู่ระบบผู้จัดการประชุม
        </a>
        <a class="item" href="{{ url_for('admin.login') }}">
            <i class="shield icon"></i> Admin
        </a>
    </div>
</div>

<style>
    .ui.cards > .card > .image {
        background: #f8f9fa !important;
    }
    
    @media only screen and (max-width: 767px) {
        .ui.cards > .card > .image img {
            max-width: 150px !important;
        }
    }
</style>
{% endblock %}